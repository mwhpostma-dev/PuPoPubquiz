<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PuPo Familie Pubquiz 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .answer-btn { 
            transition: all 0.2s ease-in-out; 
            outline: none !important; 
            -webkit-tap-highlight-color: transparent;
        }
        .answer-btn:focus { box-shadow: none !important; outline: none !important; }
        .correct { background-color: #22c55e !important; color: white !important; border: 2px solid white; transform: scale(1.05); }
        .incorrect { background-color: #ef4444 !important; color: white !important; opacity: 0.7; }
        .selected { background-color: #6366f1 !important; color: white !important; border: 2px solid white; box-shadow: 0 0 15px rgba(99, 102, 241, 0.4) !important; }
        .disabled-btn { pointer-events: none; opacity: 0.6; }
        #timer-bar-inner { transition: width 1s linear; }
        .spinner { border: 3px solid rgba(0,0,0,.1); border-radius: 50%; border-top-color: #6366f1; width: 24px; height: 24px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200 flex items-center justify-center min-h-screen p-4">

    <!-- Geluidsknop rechtsboven -->
    <div class="fixed top-4 right-4 z-50">
        <button id="toggle-sound-btn" class="bg-white dark:bg-slate-800 p-2 rounded-full shadow-md border border-slate-200 flex items-center justify-center hover:scale-110 transition-transform">
            <svg id="sound-on-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
            <svg id="sound-off-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-400 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
            </svg>
        </button>
    </div>

    <!-- Start Scherm -->
    <div id="start-screen" class="w-full max-w-md bg-white dark:bg-slate-800 shadow-2xl rounded-2xl p-8 text-center border-t-4 border-indigo-600">
        <img src="PuPo logo.png" alt="PuPo Logo" class="mx-auto mb-4 w-32 h-auto" onerror="this.style.display='none'">
        <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-6 text-slate-800 dark:text-white">PuPo Familie Pubquiz 2026</h1>
        
        <div id="loading-area" class="mb-4 text-sm">
            <div class="spinner mr-2"></div> <span id="conn-status">Verbinding maken met database...</span>
        </div>

        <div id="input-area" class="space-y-4 opacity-50 pointer-events-none">
            <input type="text" id="player-name" placeholder="Voer je naam in" class="w-full p-3 rounded-lg bg-slate-200 dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-900 dark:text-white">
            <input type="text" id="game-id-input" placeholder="Voer 6-cijferige Spel ID in" class="w-full p-3 rounded-lg bg-slate-200 dark:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-slate-900 dark:text-white">
            <button id="join-game-btn" class="w-full bg-emerald-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-emerald-600 transition-colors shadow-md">Doe mee met spel</button>
            <p class="text-slate-500 dark:text-slate-400 text-sm">of</p>
            <button id="create-game-btn" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-colors shadow-md">Maak nieuw spel (Quizmaster)</button>
        </div>
        <p id="start-error" class="text-red-500 mt-4 h-4 text-xs font-semibold"></p>
    </div>

    <!-- Quiz Container -->
    <div id="quiz-container" class="hidden w-full max-w-4xl bg-white dark:bg-slate-800 shadow-2xl rounded-2xl p-6 md:p-8 text-center border-t-4 border-indigo-600">
        <div class="flex flex-col md:flex-row gap-8">
            <div class="w-full md:w-2/3">
                <div class="flex items-center gap-4 mb-4 text-left">
                    <img src="PuPo logo.png" alt="PuPo" class="w-12 h-12 object-contain" onerror="this.style.display='none'">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-1">
                            <p class="font-semibold text-indigo-600 dark:text-indigo-400">Vraag <span id="question-number">1</span>/<span id="total-questions">10</span></p>
                            <div id="game-id-container" class="text-xs bg-indigo-50 dark:bg-indigo-900/40 px-3 py-1 rounded-full">Code: <strong id="game-id-display"></strong></div>
                        </div>
                        <div id="timer" class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 overflow-hidden">
                            <div id="timer-bar-inner" class="bg-indigo-500 h-2.5 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                
                <hr class="border-slate-100 dark:border-slate-700 mb-6">

                <div id="question-area">
                    <h3 id="round-name" class="text-xl font-bold text-indigo-400 mb-2 uppercase tracking-widest text-left"></h3>
                    <h2 id="question-text" class="text-2xl font-semibold mb-6 min-h-[100px] flex items-center justify-center text-slate-800 dark:text-white text-center">Wachten op de quizmaster...</h2>
                    <p id="answer-feedback" class="text-lg font-bold my-4 h-8"></p>
                    <div id="answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-center"></div>
                </div>

                <div class="mt-8 flex justify-center">
                    <button id="next-btn" class="hidden bg-indigo-600 text-white font-bold py-4 px-10 rounded-xl hover:bg-indigo-700 transition-all shadow-lg active:scale-95">Volgende Vraag</button>
                </div>
            </div>

            <div class="w-full md:w-1/3 border-t-2 md:border-t-0 md:border-l-2 border-slate-100 dark:border-slate-700 pt-6 md:pt-0 md:pl-6 text-left">
                 <h3 class="text-2xl font-bold mb-4 text-indigo-600 dark:text-indigo-400">Tussenstand</h3>
                 <div id="scoreboard" class="space-y-3"></div>
            </div>
        </div>
        
        <div id="score-screen" class="hidden py-10">
             <h2 class="text-4xl font-bold mb-4 text-indigo-600 dark:text-indigo-400 text-center">Quiz Voltooid!</h2>
             <p id="score-feedback" class="text-2xl mb-8 text-center text-slate-800 dark:text-white"></p>
             <button id="restart-btn" class="bg-indigo-600 text-white font-bold py-4 px-10 rounded-xl hover:bg-indigo-700 transition-all shadow-lg mx-auto block">Nieuw Spel Starten</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBKjOEFstlsSU4DoBRS_QzWGbUEneK7A08",
            authDomain: "pupo-pub-wuiz.firebaseapp.com",
            projectId: "pupo-pub-wuiz",
            storageBucket: "pupo-pub-wuiz.firebasestorage.app",
            messagingSenderId: "253915553323",
            appId: "1:253915553323:web:505a8f2a42e12c1845d46e"
        };

        const appId = 'pupo-pub-quiz-2026';

        const quizRounds = [
            {
                name: "Algemeen",
                questions: [
                    { question: "Wat is de hoofdstad van Nederland?", answers: ["Amsterdam", "Rotterdam", "Den Haag", "Utrecht"], correctAnswerIndex: 0 },
                    { question: "Hoeveel provincies heeft Nederland?", answers: ["10", "11", "12", "13"], correctAnswerIndex: 2 }
                ]
            },
            {
                name: "Waar of niet waar?",
                questions: [
                    { question: "Een groep kraaien wordt ook wel een moord genoemd", answers: ["Waar", "Niet waar"], correctAnswerIndex: 0 },
                    { question: "Het Oktoberfest begint traditioneel in september", answers: ["Waar", "Niet waar"], correctAnswerIndex: 0 }
                ]
            },
            {
                name: "Sport",
                questions: [
                    { question: "Hoe vaak won Mighty Mike het WK?", answers: ["2", "3", "4", "0"], correctAnswerIndex: 1 },
                    { question: "Cura√ßao plaatste zich in November 2025 voor het WK voetbal. Wie is de bondscoach van dit team?", answers: ["Guus Hiddink", "Stanley Menzo", "Ruud Gullit", "Dick Advocaat"], correctAnswerIndex: 3 }
                ]
            },
            {
                name: "Muziek",
                questions: [
                    { question: "Wie wordt 'The King of Pop' genoemd?", answers: ["Elvis Presley", "Michael Jackson", "Freddie Mercury", "Elton John"], correctAnswerIndex: 1 },
                    { question: "Van welk land komt de band ABBA?", answers: ["Noorwegen", "Denemarken", "Finland", "Zweden"], correctAnswerIndex: 3 }
                ]
            },
            {
                name: "Familie",
                questions: [
                    { question: "Wat is de geboortemaand van de meeste mensen in onze familie?", answers: ["Januari", "Mei", "Augustus", "Oktober"], correctAnswerIndex: 2 },
                    { question: "Welk spel spelen we het vaakst op familieweekenden?", answers: ["Catan", "30 Seconds", "Monopoly", "Kaarten"], correctAnswerIndex: 1 }
                ]
            }
        ];

        let db, auth, userId, playerName, gameId, isQuizmaster = false, playerDocId, playerAnsweredIndex = null;
        let currentGameState = {}, timerInterval, unsubscribeGame, unsubscribePlayers;
        let isSoundEnabled = true;
        let audioCtx = null;
        const QUESTION_TIME = 20;

        const elements = {
            startScreen: document.getElementById('start-screen'),
            quizContainer: document.getElementById('quiz-container'),
            playerNameInput: document.getElementById('player-name'),
            gameIdInput: document.getElementById('game-id-input'),
            createGameBtn: document.getElementById('create-game-btn'),
            joinGameBtn: document.getElementById('join-game-btn'),
            startError: document.getElementById('start-error'),
            roundName: document.getElementById('round-name'),
            questionText: document.getElementById('question-text'),
            answerButtons: document.getElementById('answer-buttons'),
            nextBtn: document.getElementById('next-btn'),
            gameIdDisplay: document.getElementById('game-id-display'),
            scoreboard: document.getElementById('scoreboard'),
            questionNumber: document.getElementById('question-number'),
            totalQuestions: document.getElementById('total-questions'),
            scoreScreen: document.getElementById('score-screen'),
            scoreFeedback: document.getElementById('score-feedback'),
            restartBtn: document.getElementById('restart-btn'),
            timerBar: document.getElementById('timer-bar-inner'),
            answerFeedback: document.getElementById('answer-feedback'),
            loadingArea: document.getElementById('loading-area'),
            inputArea: document.getElementById('input-area'),
            soundToggleBtn: document.getElementById('toggle-sound-btn'),
            soundOnIcon: document.getElementById('sound-on-icon'),
            soundOffIcon: document.getElementById('sound-off-icon')
        };

        async function init() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        elements.loadingArea.classList.add('hidden');
                        elements.inputArea.classList.remove('opacity-50', 'pointer-events-none');
                    } else {
                        await signInAnonymously(auth);
                    }
                });
            } catch (err) {
                elements.startError.textContent = "Databasefout. Probeer te verversen.";
            }
        }

        // Genereer een tikkend geluid
        function playTick() {
            if (!isSoundEnabled) return;
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        // Genereer een zoemer geluid
        function playBuzzer() {
            if (!isSoundEnabled) return;
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc1 = audioCtx.createOscillator();
            const osc2 = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc1.type = 'sawtooth';
            osc1.frequency.setValueAtTime(100, audioCtx.currentTime);
            
            osc2.type = 'sawtooth';
            osc2.frequency.setValueAtTime(103, audioCtx.currentTime); // Kleine detune voor 'dirty' effect

            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 0.05);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.8);

            osc1.connect(gain);
            osc2.connect(gain);
            gain.connect(audioCtx.destination);

            osc1.start();
            osc2.start();
            osc1.stop(audioCtx.currentTime + 0.8);
            osc2.stop(audioCtx.currentTime + 0.8);
        }

        async function createGame() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            playerName = elements.playerNameInput.value.trim();
            if (!playerName) { elements.startError.textContent = "Vul je naam in."; return; }
            if (!userId) return;
            elements.createGameBtn.disabled = true;
            isQuizmaster = true;
            try {
                gameId = Math.floor(100000 + Math.random() * 900000).toString();
                const gameRef = doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId);
                await setDoc(gameRef, {
                    quizmasterId: userId,
                    currentRoundIndex: -1,
                    currentQuestionIndex: -1,
                    rounds: quizRounds,
                    isRevealingAnswers: false,
                    createdAt: new Date()
                });
                await setupPlayer();
                startListeners();
            } catch (err) {
                elements.createGameBtn.disabled = false;
                elements.startError.textContent = "Kon spel niet aanmaken.";
            }
        }

        async function joinGame() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            playerName = elements.playerNameInput.value.trim();
            gameId = elements.gameIdInput.value.trim();
            if (!playerName || !gameId) { elements.startError.textContent = "Naam en Code verplicht."; return; }
            elements.joinGameBtn.disabled = true;
            try {
                const gameSnap = await getDoc(doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId));
                if (!gameSnap.exists()) {
                    elements.startError.textContent = "Onjuiste code.";
                    elements.joinGameBtn.disabled = false;
                    return;
                }
                isQuizmaster = false;
                await setupPlayer();
                startListeners();
            } catch (err) {
                elements.joinGameBtn.disabled = false;
                elements.startError.textContent = "Fout bij meedoen.";
            }
        }

        async function setupPlayer() {
            const playersRef = collection(db, 'artifacts', appId, 'public', 'data', 'games', gameId, 'players');
            const docRef = await addDoc(playersRef, {
                name: playerName,
                score: 0,
                isQuizmaster: isQuizmaster,
                authId: userId
            });
            playerDocId = docRef.id;
        }

        function startListeners() {
            elements.startScreen.classList.add('hidden');
            elements.quizContainer.classList.remove('hidden');
            elements.gameIdDisplay.textContent = gameId;
            if (!isQuizmaster) document.getElementById('game-id-container').style.display = 'none';
            
            unsubscribeGame = onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId), (snap) => {
                const state = snap.data();
                if (!state) return;
                const oldState = currentGameState;
                currentGameState = state;
                if (state.currentRoundIndex !== oldState.currentRoundIndex || state.currentQuestionIndex !== oldState.currentQuestionIndex) {
                    renderUI();
                }
                if (state.isRevealingAnswers && !oldState.isRevealingAnswers) {
                    revealAnswers();
                }
            });

            unsubscribePlayers = onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'games', gameId, 'players'), (snap) => {
                const players = [];
                snap.forEach(d => players.push({id: d.id, ...d.data()}));
                updateScoreboard(players);
            });
        }

        function renderUI() {
            const { currentRoundIndex, currentQuestionIndex, rounds } = currentGameState;
            
            elements.answerButtons.innerHTML = '';
            elements.answerFeedback.textContent = '';
            elements.nextBtn.classList.add('hidden');
            elements.roundName.textContent = '';
            playerAnsweredIndex = null;
            clearInterval(timerInterval);

            if (currentRoundIndex === -1) {
                elements.questionText.textContent = isQuizmaster ? "Deel de code en start de quiz!" : "Wachten tot de quizmaster start...";
                if (isQuizmaster) { 
                    elements.nextBtn.textContent = "Start Quiz"; 
                    elements.nextBtn.classList.remove('hidden'); 
                }
                return;
            }

            if (currentRoundIndex >= rounds.length) {
                showFinal();
                return;
            }

            const round = rounds[currentRoundIndex];
            elements.roundName.textContent = `Ronde: ${round.name}`;

            if (currentQuestionIndex === -1) {
                if (isQuizmaster) {
                    elements.questionText.textContent = "Klaar voor de volgende ronde?";
                    elements.nextBtn.textContent = "Start Ronde";
                    elements.nextBtn.classList.remove('hidden');
                } else {
                    elements.questionText.textContent = "De quizmaster gaat de ronde bijna starten...";
                }
                return;
            }

            setTimeout(() => {
                const q = round.questions[currentQuestionIndex];
                displayQuestion(q, round.questions.length);
            }, 50);
        }

        function displayQuestion(question, totalInRound) {
            playerAnsweredIndex = null;
            elements.answerButtons.innerHTML = ''; 
            
            elements.questionText.textContent = question.question;
            elements.questionNumber.textContent = currentGameState.currentQuestionIndex + 1;
            elements.totalQuestions.textContent = totalInRound;

            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.innerText = answer;
                button.className = 'answer-btn fade-in w-full bg-white dark:bg-slate-700 border-2 border-slate-200 dark:border-slate-600 p-4 rounded-xl text-lg font-medium shadow-sm hover:border-indigo-300 transition-all text-slate-800 dark:text-white';
                
                if (!isQuizmaster) {
                    button.onclick = () => {
                        playerAnsweredIndex = index;
                        Array.from(elements.answerButtons.children).forEach(b => b.classList.remove('selected'));
                        button.classList.add('selected');
                        button.blur();
                    };
                } else {
                    button.classList.add('disabled-btn');
                }
                elements.answerButtons.appendChild(button);
            });
            startTimer();
        }

        function revealAnswers() {
            clearInterval(timerInterval);
            const { currentRoundIndex, currentQuestionIndex, rounds } = currentGameState;
            const q = rounds[currentRoundIndex].questions[currentQuestionIndex];
            const correctAnswerIndex = q.correctAnswerIndex;
            
            if (!isQuizmaster && playerAnsweredIndex === correctAnswerIndex) {
                const pRef = doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId, 'players', playerDocId);
                getDoc(pRef).then(s => updateDoc(pRef, { score: (s.data().score || 0) + 1 }));
            }

            Array.from(elements.answerButtons.children).forEach((btn, i) => {
                btn.classList.add('disabled-btn');
                if (i === q.correctAnswerIndex) {
                    btn.classList.add('correct');
                    btn.classList.remove('selected');
                } else if (btn.classList.contains('selected')) {
                    btn.classList.add('incorrect');
                }
            });

            if (!isQuizmaster) {
                if (playerAnsweredIndex === correctAnswerIndex) {
                    elements.answerFeedback.textContent = "Goed gedaan! +1 punt";
                    elements.answerFeedback.className = "text-lg font-bold my-4 text-green-500 text-center";
                } else {
                    elements.answerFeedback.textContent = playerAnsweredIndex === null ? "Helaas, je was te laat!" : "Helaas, fout!";
                    elements.answerFeedback.className = "text-lg font-bold my-4 text-red-500 text-center";
                }
            }

            if (isQuizmaster) { 
                elements.nextBtn.textContent = 'Volgende'; 
                elements.nextBtn.classList.remove('hidden'); 
            }
        }

        async function advance() {
            const ref = doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId);
            const { currentRoundIndex, currentQuestionIndex, rounds, isRevealingAnswers } = currentGameState;
            if (currentRoundIndex === -1) return updateDoc(ref, { currentRoundIndex: 0, currentQuestionIndex: -1 });
            if (currentQuestionIndex === -1) return updateDoc(ref, { currentQuestionIndex: 0, isRevealingAnswers: false });
            if (!isRevealingAnswers) return updateDoc(ref, { isRevealingAnswers: true });
            if (currentQuestionIndex < rounds[currentRoundIndex].questions.length - 1) {
                updateDoc(ref, { currentQuestionIndex: currentQuestionIndex + 1, isRevealingAnswers: false });
            } else {
                updateDoc(ref, { currentRoundIndex: currentRoundIndex + 1, currentQuestionIndex: -1, isRevealingAnswers: false });
            }
        }

        function startTimer() {
            let time = QUESTION_TIME;
            elements.timerBar.style.width = '100%';
            elements.timerBar.classList.replace('bg-red-500', 'bg-indigo-500');
            
            // Tik direct af bij start
            playTick();

            timerInterval = setInterval(() => {
                time--;
                elements.timerBar.style.width = `${(time/QUESTION_TIME)*100}%`;
                if(time < 5) elements.timerBar.classList.replace('bg-indigo-500', 'bg-red-500');
                
                if (time > 0) {
                    playTick();
                } else if (time === 0) {
                    playBuzzer(); // Tijd is om!
                    clearInterval(timerInterval);
                    if (isQuizmaster) updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'games', gameId), { isRevealingAnswers: true });
                }
            }, 1000);
        }

        function updateScoreboard(players) {
            elements.scoreboard.innerHTML = '';
            const list = players.filter(p => !p.isQuizmaster).sort((a,b) => b.score - a.score);
            list.forEach(p => {
                const d = document.createElement('div');
                d.className = `flex justify-between p-3 rounded-xl shadow-sm border ${p.authId === userId ? 'bg-indigo-50 border-indigo-200 font-bold' : 'bg-white border-slate-100 dark:bg-slate-700'}`;
                d.innerHTML = `<span class="text-slate-700 dark:text-white">${p.name}</span><span class="text-indigo-600 font-bold">${p.score}</span>`;
                elements.scoreboard.appendChild(d);
            });
        }

        function showFinal() {
            elements.questionText.parentElement.classList.add('hidden');
            elements.scoreScreen.classList.remove('hidden');
            const list = Array.from(elements.scoreboard.querySelectorAll('div'));
            const winnerName = list.length > 0 ? list[0].firstChild.textContent : "";
            elements.scoreFeedback.innerHTML = winnerName ? `üèÜ De winnaar is: <strong class="text-indigo-600">${winnerName}</strong>` : "De quiz is afgelopen!";
        }

        elements.soundToggleBtn.onclick = () => {
            isSoundEnabled = !isSoundEnabled;
            elements.soundOnIcon.classList.toggle('hidden', !isSoundEnabled);
            elements.soundOffIcon.classList.toggle('hidden', isSoundEnabled);
            if (isSoundEnabled && !audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        };

        elements.createGameBtn.onclick = createGame;
        elements.joinGameBtn.onclick = joinGame;
        elements.nextBtn.onclick = advance;
        elements.restartBtn.onclick = () => location.reload();
        
        init();
    </script>
</body>
</html>
